<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Realtime Mail</title>

<style>
body{margin:0;font-family:sans-serif;background:#f1f3f4}
header{background:#1a73e8;color:#fff;padding:10px;font-size:20px}
#container{display:flex;height:calc(100vh - 50px)}
#sidebar{width:200px;background:#fff;border-right:1px solid #ccc}
#sidebar button{width:100%;padding:10px;border:none;background:#fff}
#sidebar button:hover{background:#e8f0fe}
#main{flex:1;padding:10px}
.mail{border-bottom:1px solid #ccc;padding:8px;cursor:pointer}
.mail:hover{background:#e8f0fe}
input,textarea{width:100%;margin-bottom:5px;padding:5px}
textarea{height:120px}
.hidden{display:none}
</style>
</head>

<body>

<header>ğŸ“¡ Realtime Mail</header>

<div id="container">
  <div id="sidebar">
    <button onclick="showInbox()">ğŸ“¥ å—ä¿¡ç®±</button>
    <button onclick="showCompose()">âœ‰ æ–°è¦ä½œæˆ</button>
  </div>

  <div id="main">
    <div id="inbox"></div>

    <div id="compose" class="hidden">
      <input id="from" placeholder="é€ä¿¡è€…å">
      <input id="subject" placeholder="ä»¶å">
      <textarea id="body" placeholder="æœ¬æ–‡"></textarea>
      <button onclick="sendMail()">é€ä¿¡</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
  getDatabase,
  ref,
  push,
  onChildAdded
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

/* Firebaseè¨­å®šï¼ˆã‚ãªãŸã®ã‚‚ã®ï¼‰ */
const firebaseConfig = {
  apiKey: "AIzaSyDpnRnfaTpJyZqOofYYVgXc78-EDmItIp4",
  authDomain: "mail-html-b1e3d.firebaseapp.com",
  databaseURL: "https://mail-html-b1e3d-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "mail-html-b1e3d",
  storageBucket: "mail-html-b1e3d.firebasestorage.app",
  messagingSenderId: "589415071537",
  appId: "1:589415071537:web:97c5e1c7240ccaba9efa10",
  measurementId: "G-YZHDNXR3XY"
};

/* åˆæœŸåŒ– */
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ãƒ¡ãƒ¼ãƒ«ä¿å­˜å ´æ‰€ */
const mailRef = ref(db, "mails");

/* é€ä¿¡å‡¦ç† */
window.send = () => {
  const user = document.getElementById("user").value;
  const text = document.getElementById("text").value;
  if (!user || !text) return;

  push(mailRef, {
    user: user,
    text: text,
    time: Date.now()
  });

  document.getElementById("text").value = "";
};

/* ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å—ä¿¡ */
const box = document.getElementById("messages");

onChildAdded(mailRef, (snapshot) => {
  const data = snapshot.val();
  const div = document.createElement("div");
  div.textContent = `${data.user}: ${data.text}`;
  box.prepend(div);
});
</script>
</body>
</html>
